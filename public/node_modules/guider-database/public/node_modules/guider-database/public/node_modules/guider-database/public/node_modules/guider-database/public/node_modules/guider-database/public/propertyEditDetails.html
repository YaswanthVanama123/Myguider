<!DOCTYPE html>
<html>
    <head>
        <script src="myguider.js"></script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/68a5b899a1.js" crossorigin="anonymous"></script>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
        <script src="https://smtpjs.com/v3/smtp.js"></script>
        <link rel="stylesheet" type="text/css" href="myguider.css">
        <link rel="stylesheet" type="text/css" href="/myguider.css">
        <script src="/myguider.js"></script>
        <script src="myguider.js"></script>
    </head>
    <body>

        <!-- section10 property Registration form -->

        <div class="center-container" id="section10">
            <div class="container9">
                <header class="reg">Registration</header>
                <form action="#" id="formRegCityAllProperty">
                    <div class="form first" id="firstFormAll">
                        <div class="details personal">
                            <span class="title">Personal Detail</span>
                            <div class="fields">
                                <div class="input-field">
                                    <label for="field1Property">Email</label>
                                    <input type="text" placeholder="Enter your email" required id="field1Property" />
                                </div>
                                <div class="input-field">
                                    <label for="field2Property">Name</label>
                                    <input type="text" placeholder="Enter your full name" required id="field2Property" />
                                </div>
                                <div class="input-field">
                                    <label for="field3Property">Age</label>
                                    <input type="number" placeholder="Enter your age" required id="field3Property" />
                                </div>
                                <div class="input-field">
                                    <label for="field4Property">How many members can stay</label>
                                    <input type="text" placeholder="Optional" id="field4Property" />
                                </div>
                                <div class="input-field">
                                    <label for="field5Property">Phone number</label>
                                    <input type="tel" placeholder="Enter your phone number" required id="field5Property" />
                                </div>
                                <div class="input-field">
                                    <label for="field6Property">State</label>
                                    <input type="text" placeholder="Enter your state" required id="field6Property" />
                                </div>
                            </div>
                        </div>

                        <div class="details ID">
                            <button class="backRegistration btn bg-primary" id="backRegistration2" onclick="Godisplay61()">Back to Home</button>
                            <button class="nextBtnProperty buttonRegistration" id="nextBtnProperty">
                                <span class="btnText">
                                    Next
                                    <i class="fa-solid fa-forward"></i>
                                </span>
                            </button>
                        </div>
                    </div>

                    <div class="form second">
                        <div class="details address">
                            <span class="title">Property Details</span>
                            <div class="fields">
                                <div class="input-field">
                                    <label for="citySearchProperty">City</label>
                                    <input type="text" placeholder="Enter your city" required id="citySearchProperty" />
                                    <div>
                                        <ul id="citySuggestionsProperty"></ul>
                                    </div>
                                </div>
                                <div class="input-field">
                                    <label for="roadSearchInputProperty">Area</label>
                                    <input type="address" placeholder="Enter pin code" required id="roadSearchInputProperty" />
                                    <div>
                                        <ul id="roadSearchSuggestionsProperty"></ul>
                                    </div>
                                </div>
                                <div class="input-field">
                                    <label for="field9Property">Pin Code</label>
                                    <input type="number" placeholder="Enter your PinCode" required id="field9Property" />
                                </div>
                                <!--        <div class="input-field">
                                    <label for="searchInputOccupationRegProperty">Occupation</label>
                                    <div class="occupation-container">
                                        <div style="position: relative;">
                                            <input type="text" placeholder="Enter your occupation" required id="searchInputOccupationRegProperty" oninput="showSuggestionsOccupationRegProperty()" onfocus="showSuggestionsOccupationRegProperty()" />
                                            <div id="suggestionsContainerOccupationRegProperty" class="suggestionsOccupation"></div>
                                        </div>
                                    </div>
                                </div>    -->


                                <div class="input-field">
                                    <label for="searchInputOccupationRegProperty">Property</label>
                                    <select class="regSelect" id="searchInputOccupationRegProperty">
                                        <option value="Shop">Shop</option>
                                        <option value="House">House</option>
                                        <option value="Place">Place or property</option>
                                    </select>
                                </div>


                                <!--             <div class="input-field">
                                    <label for="field11Property">Date of Birth</label>
                                    <input type="date" placeholder="Enter your date of birth" required id="field11Property" />
                                </div> -->

                                <div class="input-field">
                                    <label for="field11Property">Type</label>
                                    <select class="regSelect" id="field11Property">
                                        <option value="Rent">Rent</option>
                                        <option value="Lease">Lease</option>
                                        <option value="Sale">Sale</option>
                                    </select>
                                </div>




                                <div class="input-field">
                                    <label for="field12Property">Estimated Cost</label>
                                    <input type="text" placeholder="Estimated cost" required id="field12Property" />
                                </div>
                            </div>
                        </div>

                        <div class="details family">
                            <div class="buttons">
                                <div class="backBtnProperty" id="backBtnProperty">
                                    <a href="#" class="btnText">
                                        <i class="fa-solid fa-forward"></i>
                                    </a>
                                </div>
                                <button class="nextBtnProperty btn buttonRegistration" type="button">
                                    <span class="btnText" id="submitBtnProperty">
                                        Submit
                                        <i class="fa-solid fa-forward"></i>
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
    <script>


let propertyValue1 = document.getElementById("field1Property");
let propertyValue2 = document.getElementById("field2Property");
let propertyValue3 = document.getElementById("field3Property");
let propertyValue4 = document.getElementById("field4Property");
let propertyValue5 = document.getElementById("field5Property");
let propertyValue6 = document.getElementById("field6Property");
let propertyValue7 = document.getElementById("citySearchProperty");
let propertyValue8 = document.getElementById("roadSearchInputProperty");
let propertyValue9 = document.getElementById("field9Property");
let propertyValue10 = document.getElementById("searchInputOccupationRegProperty");
let propertyValue11 = document.getElementById("field11Property");
let propertyValue12 = document.getElementById("field12Property");

const submitButtonProperty = document.getElementById("submitBtnProperty");

    const formRegCityAllProperty = document.getElementById("formRegCityAllProperty");
    const nextBtnProperty = document.getElementById("nextBtnProperty");
    const backBtnProperty = document.getElementById("backBtnProperty");
    const allInputProperty = formRegCityAllProperty.querySelectorAll(".first input");

    nextBtnProperty.addEventListener("click", (event) => {
        event.preventDefault();
        let allInputPropertysFilled = true;
        allInputProperty.forEach((input) => {
            if (input.value === "") {
                allInputPropertysFilled = false;
            }
        });

        if (allInputPropertysFilled) {
            formRegCityAllProperty.classList.add("secActive");
        } else {
            formRegCityAllProperty.classList.remove("secActive");
        }
    });

    backBtnProperty.addEventListener("click", () =>
        formRegCityAllProperty.classList.remove("secActive")
    );

// city search 

const citySearchProperty = document.getElementById('citySearchProperty');
const citySuggestionsListProperty = document.getElementById('citySuggestionsProperty');

let currentPlaceProperty = {};

function handleCitySuggestionClick(place) {
    console.log('Selected City:', place);

    let cityProperty = place.address.city || place.address.name;

    citySearchProperty.value = cityProperty;

    currentPlaceProperty = {
        name: place.display_name,
        pincodeProperty: place.address.postcode
    };

    let areaProperty = place.display_place;
    let streetProperty = place.address.road;
    let pincodeProperty = place.address.postcode;

    console.log(cityProperty);
    console.log(areaProperty);
    console.log(streetProperty);
    console.log(pincodeProperty);

    citySuggestionsListProperty.innerHTML = '';
}

function debounceCityProperty(func, delay) {
    let timeoutIdProperty;
    return function() {
        clearTimeout(timeoutIdProperty);
        timeoutIdProperty = setTimeout(func, delay);
    };
}

function handleCityInputProperty() {
    const searchTermProperty = citySearchProperty.value.trim();
    if (searchTermProperty.length >= 2) {

        const apiUrl = `https://us1.locationiq.com/v1/autocomplete.php?key=pk.8bbe50a42004401570a4c08ad0e05f89&q=${searchTermProperty}`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {

                citySuggestionsListProperty.innerHTML = '';

                data.forEach(place => {
                    const li = document.createElement('li');
                    li.textContent = place.display_name;
                    li.addEventListener('click', () => handleCitySuggestionClick(place));
                    citySuggestionsListProperty.appendChild(li);
                });

                citySuggestionsListProperty.style.display = 'block';
            })
            .catch(error => console.error('Error getting city suggestions:', error));
    } else {
        citySuggestionsListProperty.style.display = 'none';
    }
}

citySuggestionsListProperty.style.display = 'none';

citySearchProperty.addEventListener('input', debounceCityProperty(handleCityInputProperty, 300));

document.addEventListener('click', (event) => {
    if (event.target !== citySearchProperty && event.target !== citySuggestionsListProperty) {
        citySuggestionsListProperty.style.display = 'none';
    }
});

// Road search

const roadSearchInputProperty = document.getElementById('roadSearchInputProperty');
const roadSearchSuggestionsProperty = document.getElementById('roadSearchSuggestionsProperty');

let currentPlaceProperty1 = {};

function handleRoadSuggestionClickProperty(place) {
    console.log('Selected Road:', place);

    let areaProperty = place.display_place;

    roadSearchInputProperty.value = areaProperty;

    currentPlaceProperty1 = {
        name: place.display_name,
        pincodeProperty: place.address.postcode
    };

    let cityProperty = place.address.city || place.address.name;
    let streetProperty = place.address.road;
    let pincodeProperty = place.address.postcode;

    console.log(cityProperty);
    console.log(areaProperty);
    console.log(streetProperty);
    console.log(pincodeProperty);

    roadSearchSuggestionsProperty.innerHTML = '';
}

function debounceRoadProperty(func, delay) {
    let timeoutIdProperty;
    return function() {
        clearTimeout(timeoutIdProperty);
        timeoutIdProperty = setTimeout(func, delay);
    };
}

function handleRoadInputProperty() {
    const searchTermProperty = roadSearchInputProperty.value.trim();
    if (searchTermProperty.length >= 2) {

        const apiUrl = `https://us1.locationiq.com/v1/autocomplete.php?key=pk.8bbe50a42004401570a4c08ad0e05f89&q=${searchTermProperty}`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {

                roadSearchSuggestionsProperty.innerHTML = '';

                data.forEach(place => {
                    const li = document.createElement('li');
                    li.textContent = place.display_name;
                    li.addEventListener('click', () => handleRoadSuggestionClickProperty(place));
                    roadSearchSuggestionsProperty.appendChild(li);
                });

                roadSearchSuggestionsProperty.style.display = 'block';
            })
            .catch(error => console.error('Error getting road suggestions:', error));
    } else {
        roadSearchSuggestionsProperty.style.display = 'none';
    }
}

roadSearchSuggestionsProperty.style.display = 'none';

roadSearchInputProperty.addEventListener('input', debounceRoadProperty(handleRoadInputProperty, 300));

document.addEventListener('click', (event) => {
    if (event.target !== roadSearchInputProperty && event.target !== roadSearchSuggestionsProperty) {
        roadSearchSuggestionsProperty.style.display = 'none';
    }
});


function handleSubmitProperty(event) {
    event.preventDefault();

    // Collect property data
    const propertyData = {
        email: propertyValue1.value,
        name: propertyValue2.value,
        age: propertyValue3.value,
        members_can_stay: propertyValue4.value,
        phonenumber: propertyValue5.value,
        state: propertyValue6.value,
        city: propertyValue7.value,
        area: propertyValue8.value,
        pincode: propertyValue9.value,
        property_type: propertyValue10.value,
        stay_type: propertyValue11.value,
        estimated_cost: propertyValue12.value,
        // Add other fields as needed
    };

    // Make an AJAX request to register property details
    fetch('/business/property/editregistration', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(propertyData),
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        alert("Property registration successful");
        // Redirect or perform other actions as needed
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}



submitButtonProperty.addEventListener("click", handleSubmitProperty);

async function fetchPropertyDetails() {
    try {
        const response = await fetch('/property/details', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        if (response.ok) {
            const data = await response.json();
            // Populate the DOM elements with the fetched data
            document.getElementById('field1Property').value = data.email || 'Not Available';
            document.getElementById('field2Property').value = data.name || 'Not Available';
            document.getElementById('field3Property').value = data.age || 'Not Available';
            document.getElementById('field4Property').value = data.members_can_stay || 'Not Available';
            document.getElementById('field5Property').value = data.phonenumber || 'Not Available';
            document.getElementById('field6Property').value = data.state || 'Not Available';
            document.getElementById('citySearchProperty').value = data.city || 'Not Available';
            document.getElementById('roadSearchInputProperty').value = data.area || 'Not Available';
            document.getElementById('field9Property').value = data.pincode || 'Not Available';
            document.getElementById('searchInputOccupationRegProperty').value = data.property_type || 'Not Available';
            document.getElementById('field11Property').value = data.stay_type || 'Not Available';
            document.getElementById('field12Property').value = data.estimated_cost || 'Not Available';
        } else {
            console.error('Error fetching property details:', response.statusText);
        }
    } catch (error) {
        console.error('Error fetching property details:', error.message);
    }
}
// Function to initialize the page
async function init() {
    // Fetch property details and populate the page
    await fetchPropertyDetails();
}

// Call the init function when the DOM content is loaded
document.addEventListener('DOMContentLoaded', init);



    </script>
    <script src="myguider.js"></script>
    </body>
</html>