<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/68a5b899a1.js" crossorigin="anonymous"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <link rel="stylesheet" type="text/css" href="myguider.css">
    <link rel="stylesheet" type="text/css" href="/myguider.css">
</head>
<body>
    <!-- skilled workers edit details -->
    <div class="center-container" id="section7">
        <div class="container9">
            <header class="reg">Registration</header>
            <form action="#" id="formRegCityAll">
                <div class="form first" id="firstFormAll">
                    <div class="details personal">
                        <span class="title">Personal Detail</span>
                        <div class="fields">
                            <div class="input-field">
                                <label for="field1">Email</label>
                                <input type="text" placeholder="Enter your email" required id="field1" />
                            </div>
                            <div class="input-field">
                                <label for="field2">Name</label>
                                <input type="text" placeholder="Enter your full name" required id="field2" />
                            </div>
                            <div class="input-field">
                                <label for="field3">Age</label>
                                <input type="number" placeholder="Enter your age" required id="field3" />
                            </div>
                            <div class="input-field">
                                <label for="field4">Gender</label>
                                <select class="regSelect" id="field4">
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="others">Others</option>
                                </select>
                            </div>
                            <div class="input-field">
                                <label for="field5">Phone number</label>
                                <input type="tel" placeholder="Enter your phone number" required id="field5" />
                            </div>
                            <div class="input-field">
                                <label for="field6">State</label>
                                <input type="text" placeholder="Enter your state" required id="field6" />
                            </div>
                        </div>
                    </div>
                    <div class="details ID">
                        <button class="backRegistration btn bg-primary" id="backRegistration1" onclick="display6()">Back to Home</button>
                        <button class="nextBtn buttonRegistration" id="nextBtn">
                            <span class="btnText">
                                Next
                                <i class="fa-solid fa-forward"></i>
                            </span>
                        </button>
                    </div>
                </div>
                <div class="form second">
                    <div class="details address">
                        <span class="title">Profession Details</span>
                        <div class="fields">
                            <div class="input-field">
                                <label for="citySearchSkilled1">City</label>
                                <input type="text" placeholder="Enter your city" required id="citySearchSkilled1" />
                                <div>
                                    <ul id="citySuggestionsListSkilled1"></ul>
                                </div>
                            </div>
                            <div class="input-field">
                                <label for="roadSearchInput">Area</label>
                                <input type="address" placeholder="Enter pin code" required id="roadSearchInput" />
                                <div>
                                    <ul id="roadSearchSuggestions"></ul>
                                </div>
                            </div>
                            <div class="input-field">
                                <label for="field9">Pin Code</label>
                                <input type="number" placeholder="Enter your occupation" required id="field9" />
                            </div>
                            <div class="input-field">
                                <label for="searchInputOccupationReg">Occupation</label>
                                <div class="occupation-container">
                                    <div style="position: relative;">
                                        <input type="text" placeholder="Enter your occupation" required id="searchInputOccupationReg" oninput="showSuggestionsOccupationReg()" onfocus="showSuggestionsOccupationReg()" />
                                        <div id="suggestionsContainerOccupationReg" class="suggestionsOccupation"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="details family">
                        <div class="buttons">
                            <div class="backBtn" id="backBtn">
                                <a href="#" class="btnText">
                                    <i class="fa-solid fa-forward"></i>
                                </a>
                            </div>
                            <button class="nextBtn btn buttonRegistration" type="button">
                                <span class="btnText" type="submit" id="submitBtn">
                                    Submit
                                    <i class="fa-solid fa-forward"></i>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>

// section 7 skilled workers 


let field1 = document.getElementById("field1");
let field2 = document.getElementById("field2");
let field3 = document.getElementById("field3");
let field4 = document.getElementById("field4");
let field5 = document.getElementById("field5");
let field6 = document.getElementById("field6");
let field7 = document.getElementById("citySearchSkilled1");
let field8 = document.getElementById("roadSearchInput");
let field9 = document.getElementById("field9");
let field10 = document.getElementById("searchInputOccupationReg");

        const formRegCityAll = document.getElementById("formRegCityAll");
        const nextBtn = document.getElementById("nextBtn");
        const backBtn = document.getElementById("backBtn");
        const allInput = formRegCityAll.querySelectorAll(".first input");
    
        nextBtn.addEventListener("click", (event) => {
            event.preventDefault();
            let allInputsFilled = true;
            allInput.forEach((input) => {
                if (input.value === "") {
                    allInputsFilled = false;
                }
            });
    
            if (allInputsFilled) {
                formRegCityAll.classList.add("secActive");
            } else {
                formRegCityAll.classList.remove("secActive");
            }
        });
    
        backBtn.addEventListener("click", (event) =>
            formRegCityAll.classList.remove("secActive")
        );


        // city search 

const citySearchSkilled1 = document.getElementById('citySearchSkilled1');
const citySuggestionsListSkilled1 = document.getElementById('citySuggestionsListSkilled1');

let currentPlaceSkilled1 = {};

function handleCitySuggestionClickSkilled1(place) {
    console.log('Selected City:', place);

    let citySkilled1 = place.address.city || place.address.name;

    citySearchSkilled1.value = citySkilled1;

    currentPlaceSkilled1 = {
        name: place.display_name,
        pincodeSkilled1: place.address.postcode
    };

    let areaSkilled1 = place.display_place;
    let streetSkilled1 = place.address.road;
    let pincodeSkilled1 = place.address.postcode;

    console.log(citySkilled1);
    console.log(areaSkilled1);
    console.log(streetSkilled1);
    console.log(pincodeSkilled1);

    citySuggestionsListSkilled1.innerHTML = '';
}

function debounceCitySkilled1(func, delay) {
    let timeoutIdSkilled1;
    return function() {
        clearTimeout(timeoutIdSkilled1);
        timeoutIdSkilled1 = setTimeout(func, delay);
    };
}

function handleCityInputSkilled1() {
    const searchTermSkilled1 = citySearchSkilled1.value.trim();
    if (searchTermSkilled1.length >= 2) {

        const apiUrl = `https://us1.locationiq.com/v1/autocomplete.php?key=pk.8bbe50a42004401570a4c08ad0e05f89&q=${searchTermSkilled1}`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {

                citySuggestionsListSkilled1.innerHTML = '';

                data.forEach(place => {
                    const li = document.createElement('li');
                    li.textContent = place.display_name;
                    li.addEventListener('click', () => handleCitySuggestionClickSkilled1(place));
                    citySuggestionsListSkilled1.appendChild(li);
                });

                citySuggestionsListSkilled1.style.display = 'block';
            })
            .catch(error => console.error('Error getting city suggestions:', error));
    } else {
        citySuggestionsListSkilled1.style.display = 'none';
    }
}

citySuggestionsListSkilled1.style.display = 'none';

citySearchSkilled1.addEventListener('input', debounceCitySkilled1(handleCityInputSkilled1, 300));

document.addEventListener('click', (event) => {
    if (event.target !== citySearchSkilled1 && event.target !== citySuggestionsListSkilled1) {
        citySuggestionsListSkilled1.style.display = 'none';
    }
});

// Road search

const roadSearchInput = document.getElementById('roadSearchInput');
const roadSearchSuggestionsList = document.getElementById('roadSearchSuggestions');

let currentPlaceSkilled11 = {};

function handleRoadSuggestionClick(place) {
    console.log('Selected Road:', place);

    let areaSkilled1 = place.display_place;

    roadSearchInput.value = areaSkilled1;

    currentPlaceSkilled11 = {
        name: place.display_name,
        pincodeSkilled1: place.address.postcode
    };

    let city = place.address.city || place.address.name;
    let streetSkilled1 = place.address.road;
    let pincodeSkilled1 = place.address.postcode;

    console.log(city);
    console.log(areaSkilled1);
    console.log(streetSkilled1);
    console.log(pincodeSkilled1);

    roadSearchSuggestionsList.innerHTML = '';
}

function debounceRoad(func, delay) {
    let timeoutIdSkilled1;
    return function() {
        clearTimeout(timeoutIdSkilled1);
        timeoutIdSkilled1 = setTimeout(func, delay);
    };
}

function handleRoadInput() {
    const searchTermSkilled1 = roadSearchInput.value.trim();
    if (searchTermSkilled1.length >= 2) {

        const apiUrl = `https://us1.locationiq.com/v1/autocomplete.php?key=pk.8bbe50a42004401570a4c08ad0e05f89&q=${searchTermSkilled1}`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {

                roadSearchSuggestionsList.innerHTML = '';

                data.forEach(place => {
                    const li = document.createElement('li');
                    li.textContent = place.display_name;
                    li.addEventListener('click', () => handleRoadSuggestionClick(place));
                    roadSearchSuggestionsList.appendChild(li);
                });

                roadSearchSuggestionsList.style.display = 'block';
            })
            .catch(error => console.error('Error getting road suggestions:', error));
    } else {
        roadSearchSuggestionsList.style.display = 'none';
    }
}

roadSearchSuggestionsList.style.display = 'none';

roadSearchInput.addEventListener('input', debounceRoad(handleRoadInput, 300));

document.addEventListener('click', (event) => {
    if (event.target !== roadSearchInput && event.target !== roadSearchSuggestionsList) {
        roadSearchSuggestionsList.style.display = 'none';
    }
});







//occupation search

const arrayOccupationReg = ["electrician", "plumber", "bike mechanic", "car mechanic", "painter", "ac mechanic", "bike and car mechanic", "driver", "welder", "auto mechanic", "daily-wage-worker", "carpenter", "saloon", "bathroom cleaning", "house cleaning", "motor repairing", "TV reparing", "Inverter reparing", "washing machine reparing", "laptop reparing", "phone reparing", "clock reparing", "tailor", "tiler", "beautician", 'cheff'];
const searchInputOccupationReg = document.getElementById("searchInputOccupationReg");
const suggestionsContainerOccupationReg = document.getElementById("suggestionsContainerOccupationReg");

document.addEventListener('click', function(event) {
    const clickedSuggestion = event.target.closest('.suggestion-itemOccupationReg');
    if (clickedSuggestion) {
        searchInputOccupationReg.value = clickedSuggestion.textContent;
        suggestionsContainerOccupationReg.style.display = 'none';
    } else if (!event.target.closest('#searchInputOccupationReg') && !event.target.closest('#suggestionsContainerOccupationReg')) {
        suggestionsContainerOccupationReg.style.display = 'none';
    }
});

function handleOccupationSuggestionClick(suggestion) {
    searchInputOccupationReg.value = suggestion;
    suggestionsContainerOccupationReg.style.display = 'none';
}

function updateOccupationSuggestions(filteredSuggestions) {
    if (filteredSuggestions.length > 0) {
        const suggestionList = filteredSuggestions.map(suggestion => `<div class="suggestion-itemOccupationReg" onclick="handleOccupationSuggestionClick('${suggestion}')">${suggestion}</div>`).join('');
        suggestionsContainerOccupationReg.innerHTML = suggestionList;
        suggestionsContainerOccupationReg.style.display = 'block';
    } else {
        suggestionsContainerOccupationReg.style.display = 'none';
    }
}

function showSuggestionsOccupationReg() {
    const inputValue = searchInputOccupationReg.value.toLowerCase();
    const filteredSuggestions = arrayOccupationReg.filter(suggestion => suggestion.toLowerCase().includes(inputValue));
    updateOccupationSuggestions(filteredSuggestions);
}



document.getElementById('submitBtn').addEventListener('click', async (event) => {
    event.preventDefault(); // Prevent default form submission behavior
    
    // Retrieve form data
    const email = document.getElementById("field1").value;
    const name = document.getElementById("field2").value;
    const age = document.getElementById("field3").value;
    const gender = document.getElementById("field4").value;
    const phonenumber = document.getElementById("field5").value;
    const state = document.getElementById("field6").value;
    const city = document.getElementById("citySearchSkilled1").value;
    const area = document.getElementById("roadSearchInput").value;
    const pincode = document.getElementById("field9").value;
    const occupation = document.getElementById("searchInputOccupationReg").value;

    try {
        const response = await fetch('/business/skilledworkers/editregistration', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email,
                name,
                age,
                gender,
                phonenumber,
                state,
                city,
                area,
                pincode,
                occupation
            })
        });

        if (response.ok) {
            // Data sent successfully
            alert('Skilled worker registered successfully!');
            // Redirect or perform any other action as needed
        } else {
            // Error handling
            alert('Error registering skilled worker. Please try again later.');
        }
    } catch (error) {
        console.error('Error registering skilled worker:', error.message);
        alert('Error registering skilled worker. Please try again later.');
    }
});


// Function to fetch skilled worker details and populate the page
async function fetchSkilledWorkerDetails() {
    try {
        const response = await fetch('/skilledworkers/details', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        if (response.ok) {
            const data = await response.json();
            // Populate the DOM elements with the fetched data
            document.getElementById('field1').value = data.email || 'Not Available';
            document.getElementById('field2').value = data.name || 'Not Available';
            document.getElementById('field3').value = data.age || 'Not Available';
            document.getElementById('field4').value = data.gender || 'Not Available';
            document.getElementById('field5').value = data.phonenumber || 'Not Available';
            document.getElementById('field6').value = data.state || 'Not Available';
            document.getElementById('citySearchSkilled1').value = data.city || 'Not Available';
            document.getElementById('roadSearchInput').value = data.area || 'Not Available';
            document.getElementById('field9').value = data.pincode || 'Not Available';
            document.getElementById('searchInputOccupationReg').value = data.occupation || 'Not Available';


        } else {
            console.error('Error fetching skilled worker details:');
        }
    } catch (error) {
        console.error('Error fetching skilled worker details:');
    }
}
// Function to initialize the page
async function init() {
    // Fetch skilled worker details and populate the page
    await fetchSkilledWorkerDetails();
}

// Call the init function when the DOM content is loaded
document.addEventListener('DOMContentLoaded', init);


            // Define the display1 function
            function display1() {
                window.location.href = '/';
            }
        
            // Define the display2 function
            function display2(){
                window.location.href = '/user/signin';
            }
        
            // Define the display5 function
            function display5() {
                window.location.href = '/business/signup';
            }
        
            // Define the display3 function
            function display3(){
                window.location.href = '/business/signin';
            }
        
            // Define the display4 function
            function display4(){
                window.location.href = '/user/signup';
            }

            // Define the display6 function 
            function display6(){
                window.location.href = '/business/service';
            }
        
            // Define the display7 function 
            function display7(){
                window.location.href = '/business/skilledworkers/registration';
            }
    </script>

    <script src="myguider.js"></script>
</body>
</html>
